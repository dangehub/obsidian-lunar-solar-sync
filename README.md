# Lunar Solar Sync

将属性中的农历日期批量转换为公历属性的 Obsidian 插件。支持单笔记或全库执行，支持闰月策略、输出键名模板与日期格式自定义。

> 输入格式固定：`农历YYYY-闰MM-DD` 或 `农历YYYY-MM-DD`（“农历”前缀可省略，闰月用“闰”标记）。

## 功能
- 两条命令：
  - `将当前笔记的农历属性转换为公历`
  - `将所有笔记的农历属性转换为公历`（可限定目录）
- 输出模式
  - 单一年份：写入“最近一次”对应公历日期到指定键
  - 多年份：以当前年为中心，生成前/后范围年份的公历日期，键名支持 moment 模板（纯文本请加 `[]` 转义）
- 闰月策略：严格闰月 / 向前折算 / 向后折算，可全局配置，也可在笔记内用自定义键覆盖

## 安装

暂未上架，请手动安装。

## 使用
1) 在 Obsidian 启用插件并打开设置页
2) 配置输入键名（默认 `lunar-birthday`），确保值形如 `农历2023-闰02-10` 或 `农历1999-01-18`
3) 选择输出模式与输出键（或键名模板）以及输出日期格式（moment 格式）
4) 如需限定目录，设置“目标目录”
5) 运行命令：
   - 当前笔记：`将当前笔记的农历属性转换为公历`
   - 全部笔记：`将所有笔记的农历属性转换为公历`

## 配置项概览
- 输入键名：front matter 中的农历字段，固定格式 `农历YYYY-闰MM-DD` / `农历YYYY-MM-DD`
- 输出模式：
  - 单一：输出键名（默认 `birthday`）+ 输出日期格式（默认 `YYYY-MM-DD`）
  - 多年：输出键名模板（默认 `[birthday]-YYYY`，纯文本请加 `[]`），年份范围（前/后）
- 闰月策略（默认向前折算）：
  - 严格闰月：目标年必须有对应闰月
  - 向前折算：闰月按同月处理
  - 向后折算：闰月按下一月处理
- 笔记内覆盖键：front matter 中填策略文本（严格闰月/向前折算/向后折算）可覆盖默认
- 目标目录：仅“全部笔记”命令生效，为空则全库

## 示例
输入：
```yaml
---
lunar-birthday: 农历2023-闰02-10
闰月处理模式: 严格闰月
---
```
单一年份模式输出示例：
```yaml
---
lunar-birthday: 农历2023-闰02-10
闰月处理模式: 严格闰月
birthday: 2042-03-31
---
```
多年份模式（模板 `[birthday]-YYYY`，范围前后各 1 年）输出示例：
```yaml
---
lunar-birthday: 农历1999-01-18
birthday-2025: 2025-02-15
birthday-2026: 2026-03-06
---
```

## 构建与开发
- `npm install`
- `npm run build` 生成 `main.js`
- 主要文件：
  - `src/main.ts` 插件入口与核心逻辑
  - `manifest.json` 插件元数据
  - `esbuild.config.mjs` / `tsconfig.json` 构建配置

## 注意
- 输出键名模板与日期格式均使用 moment 格式；纯文本会请加 `[]` 转义
- 输出键默认覆盖同名字段
- 闰月向后搜索最多 80 年以找到最近一次对应公历日期
